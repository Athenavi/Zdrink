# 第二步：设置REST API框架和用户认证系统

现在我们将设置REST API框架和用户认证系统，这是构建前后端分离应用的基础。

## 1. 安装额外的依赖包

更新 `backend/requirements.txt`，添加以下依赖：

```txt
# 在原有基础上添加以下内容
djangorestframework-simplejw
django-allauth
django-rest-auth
drf-spectacular
channels
channels-redis
```

安装新依赖：
```bash
pip install -r requirements.txt
```

## 2. 配置Django REST Framework和JWT认证

更新 `zdrink_core/settings.py`

## 3. 创建用户认证相关的序列化器

在 `apps/users/serializers.py` 中创建用户认证相关的序列化器：

## 4. 创建用户认证视图

在`apps/users/api.py` 中创建用户认证视图：


## 5. 配置URL路由

更新项目根URL配置 `zdrink_core/urls.py`：

创建用户应用的URL配置 `apps/users/urls.py`：

```python
from django.urls import path
from .api import UserProfileView

urlpatterns = [
    path('profile/', UserProfileView.as_view(), name='user_profile'),
]
```

为其他应用创建空的URL配置文件：

```bash
# 在每个app目录中创建urls.py文件
touch apps/core/urls.py
touch apps/shops/urls.py
touch apps/products/urls.py
touch apps/orders/urls.py
touch apps/payments/urls.py
```

在每个空的urls.py中添加基础内容：
```python
from django.urls import path

urlpatterns = [
    # 后续添加具体路由
]
```

## 6. 创建用户管理后台

更新 `apps/users/admin.py`：


## 7. 测试API

启动开发服务器：
```bash
python manage.py runserver
```

现在可以测试以下API端点：

- **注册用户**: POST `/api/auth/register/`
- **用户登录**: POST `/api/auth/login/`
- **获取当前用户**: GET `/api/auth/me/`
- **API文档**: GET `/api/docs/`

使用curl测试注册API：
```bash
curl -X POST /api/auth/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "testpassword123",
    "password2": "testpassword123",
    "email": "test@example.com",
    "phone": "13800138000",
    "user_type": "customer"
  }'
```

## 下一步计划

完成用户认证系统后，下一步我们将：
1. 实现多租户架构（SaaS模式）
2. 创建店铺管理基础模块
3. 设置权限管理系统