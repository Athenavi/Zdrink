# 第七步：实现云小票打印和桌面扫码点餐收银台功能

现在我们将实现云小票打印功能和桌面扫码点餐收银台功能，这是餐饮系统的核心运营功能。

## 1. 云小票打印功能

### 1.1 安装打印相关依赖

更新 `backend/requirements.txt`：

```txt
# 在原有基础上添加
escpos==3.0a4
qrcode[pil]==7.4.2
reportlab==4.0.4
django-qr-code==2.2.0
```

安装新依赖：
```bash
pip install -r requirements.txt
```

### 1.2 创建打印模型和服务

创建 `apps/printing/models.py`

### 1.3 创建打印服务

创建 `apps/printing/services.py`

### 1.4 创建打印序列化器

创建 `apps/printing/serializers.py`

### 1.5 创建打印API视图

创建 `apps/printing/api.py`

### 1.6 配置打印URL路由

创建 `apps/printing/urls.py`

## 2. 桌面扫码点餐和收银台功能

### 2.1 扩展桌台管理

更新 `apps/shops/models.py`，在Table模型中添加：

### 2.2 创建收银台服务

创建 `apps/pos/services.py`

### 2.3 创建POS序列化器

创建 `apps/pos/serializers.py`

### 2.4 创建POS API视图

创建 `apps/pos/api.py`

### 2.5 配置POS URL路由

创建 `apps/pos/urls.py`：

## 3. 更新项目配置

### 3.1 更新项目设置

在 `zdrink_core/settings.py` 中添加新应用和打印配置：

### 3.2 更新项目URL配置

在 `zdrink_core/urls.py` 中添加
## 4. 创建数据库迁移

```bash
# 创建迁移文件
python manage.py makemigrations printing shops

# 执行迁移
python manage.py migrate_schemas
```

## 5. 创建管理后台配置

### 5.1 打印管理后台

在 `apps/printing/admin.py` 中：

### 5.2 桌台管理后台

在 `apps/shops/admin.py` 中添加

## 6. 测试新功能

启动开发服务器并测试新功能：

1. **云小票打印测试**:
   ```
   POST /api/printing/printers/1/test_print/
   {
     "content": "测试打印内容"
   }

   POST /api/printing/print-order/
   {
     "order_id": 1,
     "printer_id": 1,
     "print_type": "both"
   }
   ```

2. **POS收银台测试**:
   ```
   POST /api/pos/pos/quick_order/
   {
     "order_type": "dine_in",
     "customer_name": "测试客户",
     "table_number": "A01",
     "payment_method": "cash",
     "items": [
       {
         "product_id": 1,
         "quantity": 2
       }
     ]
   }

   POST /api/pos/pos/scan_barcode/
   {
     "barcode": "1234567890123"
   }
   ```

3. **桌台管理测试**:
   ```
   GET /api/pos/tables/status/
   POST /api/pos/tables/update_status/
   {
     "table_id": 1,
     "status": "occupied",
     "order_id": 1
   }
   ```

## 下一步计划

1. **多语言和国际化的支持**
2. **系统监控和告警功能**